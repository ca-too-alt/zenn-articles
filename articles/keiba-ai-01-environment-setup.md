---
title: "【環境編】Python競馬AIを支える技術スタック (Docker, Poetry, Postgres)"
emoji: "🐎"
type: "tech"
topics: ["python", "docker", "fastapi", "postgresql", "poetry"]
published: true
---

# 【環境編】Python競馬AIを支える技術スタック (Docker, Poetry, Postgres)

## はじめに：形から入るのも悪くない

「はじめに」の記事で、IT未経験からAI開発に挑む経緯をお話ししました。
今回は、開発を始めるにあたって準備した「道具（ツール）」についてです。

正直に言うと、最初は**「Pythonでアプリを作るには何が必要なのか？」すら分かっていませんでした。**
`pip` という言葉も知りません。「とりあえずAIに聞いてみよう」と、「競馬予想アプリを作りたいんだけど、何が必要？」と丸投げしました。

そこでAIと要件（Webで見たい、データはたくさん溜めたい、など）をすり合わせた結果、提示されたのが以下の構成でした。

## 1. 技術選定の全体像

この競馬予想AIは、以下の技術で動いています。

- **言語:** Python 3.10
- **パッケージ管理:** Poetry
- **データベース:** PostgreSQL
- **Webフレームワーク:** FastAPI
- **ORM (DB操作):** SQLAlchemy (Async)
- **実行環境:** Docker

これらのツールの用途について、AIから説明してもらいました。

## 2. Poetry：依存関係と仮想環境の管理

Pythonのパッケージ管理ツールです。`pip` と `requirements.txt` の組み合わせで起こりがちな依存関係の競合（Dependency Hell）を防ぎます。

- **厳密なバージョン管理**: `poetry.lock` ファイルにより、開発環境と本番環境で完全に同じライブラリバージョンを保証します。
- **仮想環境の自動生成**: プロジェクトごとに独立した仮想環境（`.venv`）を自動的に作成・管理し、システム全体のPython環境を汚染しません。
- **コマンドの統一**: ライブラリの追加、削除、仮想環境での実行などを `poetry` コマンド一つで行えます。

## 3. PostgreSQL：堅牢なリレーショナルデータベース

オープンソースの強力なリレーショナルデータベース管理システム（RDBMS）です。

- **JSONB型の活用**: スクレイピングした非構造化データ（JSON）をそのまま格納し、かつSQLで高速に検索・集計が可能です。仕様変更の多い開発初期において、スキーマ変更なしでデータを蓄積できる点は大きなメリットです。
- **配列型のサポート**: 枠番や馬番のリストなど、配列データを効率的に扱えます。
- **Alembicによるマイグレーション**: データベースのスキーマ変更（テーブル作成やカラム追加）をコード（Pythonスクリプト）として管理し、Gitでバージョン管理を行います。

## 4. FastAPI & SQLAlchemy：モダンなWeb API構築

### FastAPI
Pythonの標準機能である型ヒント（Type Hints）をベースにした、高速なWebフレームワークです。

- **高速な動作**: StarletteとPydanticを基盤としており、高いパフォーマンスを発揮します。
- **自動ドキュメント生成**: コードを書くだけで、Swagger UIによる対話的なAPIドキュメントが自動生成されます。
- **非同期処理**: `async/await` 構文をネイティブにサポートしており、DBアクセスなどのI/O待ち時間に別の処理を並行して行えます。

### SQLAlchemy (Async)
Pythonで最も普及しているORM（Object Relational Mapper）です。

- **DB操作の抽象化**: SQLを直接書かずに、Pythonのクラスやオブジェクトとしてデータベースを操作できます。
- **非同期対応**: バージョン1.4/2.0以降で非同期IO（asyncio）を本格的にサポートしており、FastAPIの非同期処理能力を活かしたDBアクセスが可能です。

## 5. Docker：開発環境のコンテナ化

アプリケーションとその実行環境（OS、ライブラリ、設定）を「コンテナ」としてパッケージ化する技術です。

- **環境の一致**: 開発者のPC（Windows/Mac）と本番サーバー（Linux）で、全く同じ環境を再現できます。
- **構築の簡素化**: `docker-compose.yml` に構成を記述することで、コマンド一つ（`docker-compose up`）でDBサーバーとアプリケーションサーバーを立ち上げることができます。

## まとめ：

正直、アプリのコードなんて全部テキストデータだと思っていたら、たくさんのツールやらライブラリやらインストールさせられました。

ともかく、環境は整いました。次の記事では、「設計」についてお話しします。
