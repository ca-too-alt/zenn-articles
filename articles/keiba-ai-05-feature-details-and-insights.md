---
title: "【特徴量解説】AIはレースをどう見ているのか？"
emoji: "👁️"
type: "tech"
topics: ["python", "機械学習", "featureengineering", "データ分析", "競馬"]
published: false
---

# 【特徴量解説】AIはレースをどう見ているのか？

## はじめに：AIの「眼」を作る作業

AI開発と聞くと、複雑な数式やアルゴリズムを想像するかもしれません。しかし、競馬予想AIの性能を最も左右するのは、実は「特徴量エンジニアリング」という地味な作業です。

これは、AIに「レースのどこに注目すべきか」を教える作業に他なりません。人間が馬柱や過去のレース映像を見て「この馬は中山が得意だな」「この騎手は逃げ馬に乗ると上手い」と判断するのと同じことを、AIが理解できる「数値」に変換していくプロセスです。

今回は、この競馬予想AIがどのようなデータを見て学習しているのか、その「特徴量」の一部をご紹介します。

## 1. データベースから取得する「素の」データ

まずは、スクレイピングによってデータベースに格納された、加工前の基本的なデータです。これらがすべての分析の土台となります。

### レース情報
- **`racetrack` (競馬場):** 東京、中山、京都など。
- **`course_type` (コース種別):** 芝、ダート、障害。
- **`distance` (距離):** 1200m, 1600m, 2400mなど。
- **`grade` (グレード):** G1, G2, G3, リステッド, オープン, 1勝クラスなど。
- **`track_condition` (馬場状態):** 良, 稍重, 重, 不良。

### 出走馬情報
- **`horse_number` (馬番), `gate_number` (枠番):** 内枠・外枠の有利不利を判断する基本情報。
- **`burden_weight` (斤量):** ハンデ戦などで重要になる、馬が背負う重さ。
- **`horse_weight` (馬体重), `weight_diff` (馬体重増減):** 当日の馬の状態を測る指標。

### 関係者・血統情報
- **`jockey_id` (騎手), `trainer_id` (調教師):** 騎手や厩舎の得意・不得意を分析するためのキー。
- **`father` (父), `broodmare_sire` (母父):** 血統による距離適性や馬場適性を判断するためのキー。

### 過去の成績
- **`rank` (着順):** 最も重要な結果データ。
- **`finish_time` (走破タイム), `last_3f_time` (上がり3F):** 馬の能力の絶対的な指標。
- **`interval` (レース間隔):** 前走からの間隔。休み明けか、連戦か。
- **`corner_1`〜`corner_4` (コーナー通過順位):** その馬がどのような位置取りでレースを進めたか（脚質）を示す重要なデータ。

## 2. AIの思考を助ける「加工」データ（特徴量）

上記の「素の」データだけでは、AIは賢く学習できません。そこで、これらのデータを組み合わせて、より意味のある「特徴量」を生成します。

### パフォーマンススコア（相対評価）
「走破タイム 1:33.0」という数字だけでは、その価値は分かりません。超高速馬場だったのか、それとも時計のかかる馬場だったのかで全く意味が異なるからです。

そこで、**「そのレースの平均タイムよりどれだけ速かったか（遅かったか）」**という偏差（`performance_score`）を計算します。これにより、馬場状態や展開に左右されない、その馬の純粋なパフォーマンスを評価できます。上がり3Fについても同様のスコア（`last_3f_score`）を計算します。

### 脚質・展開の数値化
コーナー通過順位を、**「レース全体の前方から何%の位置にいたか」**という `position_score`（0.0: 先頭 〜 1.0: 最後方）に変換します。

さらに、これを馬ごと・騎手ごとに集計することで、以下のような特徴量を作ります。

- **`avg_position_score` (馬の平均位置取りスコア):** その馬が本来「逃げ馬」なのか「追込馬」なのか。
- **`jockey_position_bias` (騎手の位置取りバイアス):** `騎手の平均位置取り - 馬の平均位置取り` を計算します。
  - プラスなら「馬の脚質より後ろに乗る傾向」、マイナスなら「馬の脚質より前につける傾向（積極策）」がある騎手だと判断できます。

### 適性の数値化（アフィニティ）
パフォーマンススコアを様々な条件で集計することで、「馬と〇〇の相性」を数値化します。

- **`perf_score_by_racetrack` (競馬場別スコア):** その馬の「中山巧者」「東京巧者」といった適性を表します。
- **`sire_perf_score_by_course_type` (種牡馬のコース種別スコア):** 「この父の産駒はダートでよく走る」といった血統傾向を表します。
- **`jockey_course_affinity` (騎手のコース相性):** `騎手のコース別平均スコア - 騎手の全コース平均スコア` を計算します。
  - プラスなら、その騎手がそのコースを得意としている（平均以上に走れている）ことを示します。

## まとめ

ここで紹介した特徴量はほんの一部です。実際には、これらの特徴量をさらに組み合わせたり、異なる角度から集計したりすることで、AIはレースを多角的に分析しています。

「どのデータを、どう加工すれば、AIはもっと賢くなるのか？」

この問いこそが、特徴量エンジニアリングの面白さであり、競馬予想AI開発の核心と言えるでしょう。

次回は、これらの特徴量を使って実際に予測を行う「機械学習モデル」の仕組みについて解説します。
